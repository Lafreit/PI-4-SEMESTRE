{% extends "base.html" %}
{% load static %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'perfil.css' %}">
{% endblock %}

{% block content %}
<nav class="navbar">
    <a href="{% url 'home' %}" class="logo">CaronaApp</a>
    <div class="nav-links">
        <a href="{% url 'usuarios:pagina_inicial' %}" class="nav-item">In√≠cio</a>
        <a href="{% url 'usuarios:meu_perfil' %}" class="nav-item">Meu Perfil</a>
        <a href="#" class="nav-item">Minhas Viagens</a>
        <a href="#" class="nav-item">Central de Ajuda</a>
    </div>
    <a href="{% url 'usuarios:logout' %}" class="nav-logout">Sair</a>
</nav>

<main class="profile-container">
    
    {# --- Bot√£o de Modo Escuro (Posicionado) --- #}
    <button onclick="toggleDarkMode()" class="action-btn" style="position:absolute;top:20px;right:20px;z-index:100; font-size: 1.2em; padding: 10px;">
        üåô
    </button>
    
    {# --- 1. Header/Banner do Perfil --- #}
    <div class="header-banner">
        <h1>Meu Perfil üöó</h1>
        <p>Gerencie sua conta, ve√≠culo, desempenho e vantagens exclusivas.</p>
    </div>

    {# --- 2. Bloco de Mensagens/Notifica√ß√µes (Posi√ß√£o Correta) --- #}
    {% if messages %}
        <div class="message-container" style="margin-bottom: 20px;">
            {% for message in messages %}
                <div class="notification-banner {% if message.tags == 'success' %}success-message{% elif message.tags == 'error' %}error-message{% endif %}"
                    role="alert">
                    <span style="margin-right: 10px; font-size: 1.2em;">
                        {% if message.tags == 'success' %}‚úÖ{% elif message.tags == 'error' %}‚ùå{% endif %}
                    </span>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    {# --- 3. Grid de Cards --- #}
    <div class="profile-cards-grid">
        
        <section class="card profile-info-card">
            <h3>Dados Pessoais</h3>
            <p><strong>Nome:</strong> {{ user.nome }}</p>
            <p><strong>Email:</strong> {{ user.email }}</p>
            <p><strong>Tipo de Usu√°rio:</strong> {{ user.tipo_usuario|capfirst }}</p>
            
            <a href="{% url 'usuarios:editar_perfil' %}" class="action-btn edit-btn">
                Editar Dados
            </a>
        </section>

        <section class="card vehicle-info-card">
            <h3>Informa√ß√µes do Ve√≠culo</h3>
            <p><strong>Modelo:</strong> {{ user.profile_data.modelo_veiculo|default:"N√£o Cadastrado" }}</p>
            <p><strong>Placa:</strong> {{ user.profile_data.placa|default:"N/A" }}</p>
            <p><strong>CPF Cadastrado:</strong> {{ user.profile_data.cpf|default:"N/A" }}</p>
            <p><strong>Status de Aprova√ß√£o:</strong> <span class="status approved">Aprovado</span></p>
            
            <a href="{% url 'usuarios:editar_perfil' %}" class="action-btn secondary-btn">
                Atualizar Ve√≠culo
            </a>
        </section>

        <section class="card plans-card">
            <h3>Planos Dispon√≠veis üíé</h3>
            <div class="plan-item">
                <span>**Plano Motorista Pro (Mensal)**</span>
                <span class="plan-status active">Ativo</span>
            </div>
            <div class="plan-item">
                <span>**Plano VIP Completo**</span>
                <span class="plan-status upgrade">Fazer Upgrade</span>
            </div>
            <p style="margin-top: 15px;">Seu plano atual garante taxas de comiss√£o reduzidas.</p>
            <button class="action-btn secondary-btn">Gerenciar Assinatura</button>
        </section>

        <section class="card ratings-card">
            <h3>Minhas Avalia√ß√µes</h3>
            <p class="rating-value">4.9 ‚≠ê</p>
            <p>Total de corridas: 150</p>
            <p>Avalia√ß√µes 5 Estrelas: 98%</p>
            <a href="#" class="link-details">Ver Detalhes</a>
        </section>

        <section class="card documents-card">
            <h3>Documentos</h3>
            <p>Verifique se sua CNH e CRLV est√£o em dia.</p>
            <p>Pr√≥xima Verifica√ß√£o: 10/12/2025</p>
            <button class="action-btn primary-btn">Ver Documentos</button>
        </section>

        <section class="card help-center-card">
            <h3>Central de Ajuda ‚ùì</h3>
            <p>Encontre respostas r√°pidas, envie feedback ou reporte um problema na rota.</p>
            <p>Hor√°rio de Atendimento: 24/7</p>
            <a href="#" class="action-btn secondary-btn">Acessar Suporte</a>
        </section>

    </div>
</main>
{% endblock %}

{% block scripts %}
<script>
    // ====================== MODO ESCURO ======================
    function toggleDarkMode() {
        // Alterna a classe dark-mode no body
        document.body.classList.toggle("dark-mode");
        
        // Salva a prefer√™ncia do usu√°rio no armazenamento local
        localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
        
        // Opcional: Altera o √≠cone do bot√£o
        const btn = document.querySelector('button[onclick="toggleDarkMode()"]');
        if (btn) {
            btn.textContent = document.body.classList.contains("dark-mode") ? '‚òÄÔ∏è' : 'üåô';
        }
    }

    // ====================== CHAMADA PRINCIPAL (Inicializa√ß√£o) ======================
    window.onload = function() {
        // Verifica a prefer√™ncia salva ao carregar a p√°gina
        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark-mode");
        }
        
        // Define o √≠cone inicial correto
        const btn = document.querySelector('button[onclick="toggleDarkMode()"]');
        if (btn) {
            btn.textContent = document.body.classList.contains("dark-mode") ? '‚òÄÔ∏è' : 'üåô';
        }
    };
</script>
{% endblock %}
